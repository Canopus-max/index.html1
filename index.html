<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Counting down to us ðŸ’–</title>
  <style>
    :root {
      --bg1: #ff9ec2; /* soft pink */
      --bg2: #a288f2; /* lilac */
      --card: rgba(255,255,255,0.18);
      --text: #1a1333;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    body {
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      display: grid;
      place-items: center;
      overflow: hidden;
    }
    .wrap {
      width: min(720px, 92vw);
      background: var(--card);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 28px 24px 32px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.15);
      text-align: center;
      color: var(--text);
      position: relative;
      z-index: 2;
    }
    h1 { margin: 6px 0 14px; font-size: clamp(22px, 4vw, 34px); }
    .subtitle { opacity: .8; margin-bottom: 22px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin: 18px 0 8px;
    }
    .box {
      background: rgba(255,255,255,0.62);
      border-radius: 18px;
      padding: 16px 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }
    .num { font-size: clamp(28px, 7vw, 56px); font-weight: 800; letter-spacing: 1px; }
    .lbl { margin-top: 6px; font-size: 12px; letter-spacing: 1.5px; text-transform: uppercase; opacity: .7; }
    .msg { margin-top: 18px; font-size: 14px; opacity: .9; }
    .footer { margin-top: 22px; font-size: 12px; opacity: .7; }

    /* floating hearts */
    .hearts { position: fixed; inset: 0; overflow: hidden; z-index: 1; pointer-events: none; }
    .heart {
      position: absolute; bottom: -40px;
      font-size: 16px; opacity: .8;
      animation: float linear forwards;
    }
    @keyframes float {
      to { transform: translateY(-110vh); opacity: 0; }
    }

    /* button */
    .next-toggle {
      margin-top: 14px;
      border: 0; padding: 10px 14px; border-radius: 12px;
      background: rgba(255,255,255,0.7);
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      cursor: pointer; font-weight: 600;
    }

    /* smaller on narrow screens */
    @media (max-width: 420px){
      .grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <!-- Canvas for confetti, positioned behind everything but visible -->
  <canvas id="confetti-canvas" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999;"></canvas>

  <div class="hearts" aria-hidden="true"></div>

  <main class="wrap">
    <div class="subtitle">Countdown for</div>
    <!-- The text here will be replaced by JS, but it's good for fallback -->
    <h1><span id="event-name">Our Anniversary</span> ðŸ’ž</h1>

    <div class="grid" role="timer" aria-live="polite">
      <div class="box"><div class="num" id="days">0</div><div class="lbl">Days</div></div>
      <div class="box"><div class="num" id="hours">0</div><div class="lbl">Hours</div></div>
      <div class="box"><div class="num" id="minutes">0</div><div class="lbl">Minutes</div></div>
      <div class="box"><div class="num" id="seconds">0</div><div class="lbl">Seconds</div></div>
    </div>

    <p class="msg" id="message">Days until I get to celebrate us again ðŸ’–</p>
    <button class="next-toggle" id="toggle">Switch Occurrence</button>
    <div class="footer">Made with love.</div>
  </main>
  
  <!-- Make sure you have an mp3 file named 'ding.mp3' in the same folder as this HTML file -->
  <audio id="celebration-sound" src="ding.mp3" preload="auto"></audio>

  <script>
    /************ 1) SET YOUR EVENT HERE ************/
    // Option A: set a specific target date/time in your local timezone (YYYY-MM-DDTHH:MM)
    // Example: const TARGET_ISO = "2026-11-09T00:00:00";
    const TARGET_ISO = ""; // leave blank if you prefer Option B

    // Option B: set a repeating anniversary by month & day (uses your local timezone)
    const ANNIV_MONTH = 8; // 1-12 (e.g. 8 for August)
    const ANNIV_DAY   = 13;  // 1-31
    const ANNIV_HOUR  = 20;  // 0-23 (8 PM)
    const ANNIV_MIN   = 54;  // 0-59
    const EVENT_NAME  = "Cano & Awis Anniversary"; // shows in the title

    /************ 2) CELEBRATION & EFFECTS ************/
    let celebrationLaunched = false; // Flag to prevent re-triggering

    // Combined function to trigger all celebration effects
    function celebrate() {
      launchConfetti();
      const sound = document.getElementById("celebration-sound");
      // Browsers may block audio, so we try to play and catch any errors silently.
      sound.play().catch(e => console.error("Audio could not play:", e));
    }

    // Confetti / hearts effect using Canvas
    function launchConfetti() {
      const canvas = document.getElementById("confetti-canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const pieces = [];
      const shapes = ["â™¥", "ðŸ’–", "ðŸ’•", "ðŸ’ž", "âœ¨"];
      const colors = ["#ff4d6d", "#ff99ac", "#ff1e56", "#ff6f91", "#fff"];

      for (let i = 0; i < 100; i++) {
        pieces.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height, // Start above the screen
          size: Math.random() * 28 + 14,
          speed: Math.random() * 3 + 2,
          char: shapes[Math.floor(Math.random() * shapes.length)],
          color: colors[Math.floor(Math.random() * colors.length)],
        });
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        pieces.forEach(p => {
          ctx.font = `${p.size}px serif`;
          ctx.fillStyle = p.color;
          ctx.fillText(p.char, p.x, p.y);
        });
      }

      function update() {
        pieces.forEach(p => {
          p.y += p.speed;
          if (p.y > canvas.height + 50) { // When it falls off screen
            p.y = -50; // Restart from the top
            p.x = Math.random() * canvas.width;
          }
        });
      }

      let animationFrameId;
      function loop() {
        draw();
        update();
        animationFrameId = requestAnimationFrame(loop);
      }
      loop();
      // Optional: Stop the confetti after a while to save performance
      setTimeout(() => cancelAnimationFrame(animationFrameId), 20000);
    }
    
    /************ 3) COUNTDOWN LOGIC ************/
    const nameEl = document.getElementById("event-name");
    const msgEl = document.getElementById("message");
    const h1El = document.querySelector("h1");
    nameEl.textContent = EVENT_NAME;
    h1El.innerHTML = `${EVENT_NAME} ðŸ’ž`;

    function pad(n){ return String(n).padStart(2,"0"); }

    function getNextOccurrence(month, day, hour=0, min=0){
      const now = new Date();
      let target = new Date(now.getFullYear(), month - 1, day, hour, min, 0, 0);
      if (target < now) {
        target = new Date(now.getFullYear() + 1, month - 1, day, hour, min, 0, 0);
      }
      return target;
    }

    function getTargetDate(){
      if (TARGET_ISO && TARGET_ISO.trim() !== "") return new Date(TARGET_ISO);
      return getNextOccurrence(ANNIV_MONTH, ANNIV_DAY, ANNIV_HOUR, ANNIV_MIN);
    }

    let useNextOccurrence = !(TARGET_ISO && TARGET_ISO.trim() !== "");
    let target = getTargetDate();

        function updateCountdown(){
      const now = new Date();
      let diff = target - now;

      if (diff <= 0) {
        // Countdown reached!
        document.getElementById("days").textContent = "00";
        document.getElementById("hours").textContent = "00";
        document.getElementById("minutes").textContent = "00";
        document.getElementById("seconds").textContent = "00";
        msgEl.textContent = "Itâ€™s today! Happy us ðŸŽ‰";
        
        // --- NEW ---
        // Change the button text to make it clear what to do next
        document.getElementById("toggle").textContent = "Countdown to Next Year?";
        // --- END NEW ---

        // Check the flag before launching the celebration
        if (!celebrationLaunched) {
          celebrate();
          celebrationLaunched = true; // Set flag to true so it doesn't run again
        }
        return;
      }
      
      // If the timer is still running, make sure the button text is normal
      document.getElementById("toggle").textContent = "Switch Occurrence";

      const totalSeconds = Math.floor(diff / 1000);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      document.getElementById("days").textContent = pad(days);
      document.getElementById("hours").textContent = pad(hours);
      document.getElementById("minutes").textContent = pad(minutes);
      document.getElementById("seconds").textContent = pad(seconds);
    }

    const timerInterval = setInterval(updateCountdown, 1000);
    updateCountdown(); // Initial call to display time immediately

    // Toggle button logic
    document.getElementById("toggle").addEventListener("click", () => {
      if (TARGET_ISO && TARGET_ISO.trim() !== "") {
        alert("You set a specific date/time (Option A). Clear TARGET_ISO to use repeating anniversaries (Option B).");
        return;
      }
      
      const now = new Date();
      const thisYearAnniversary = new Date(now.getFullYear(), ANNIV_MONTH - 1, ANNIV_DAY, ANNIV_HOUR, ANNIV_MIN);
      
      // This logic decides which date to switch to
      if (target.getFullYear() > now.getFullYear() || (target.getTime() === getNextOccurrence(ANNIV_MONTH, ANNIV_DAY, ANNIV_HOUR, ANNIV_MIN).getTime() && thisYearAnniversary > now)) {
          // If we are currently aiming for next year, switch to this year's date.
          target = thisYearAnniversary;
          msgEl.textContent = "Counting down to this yearâ€™s date ðŸ’";
      } else {
          // Otherwise, switch to the next upcoming occurrence.
          target = getNextOccurrence(ANNIV_MONTH, ANNIV_DAY, ANNIV_HOUR, ANNIV_MIN);
          msgEl.textContent = "Days until I get to celebrate us again ðŸ’–";
      }
      
      // Reset the celebration flag and update the countdown
      celebrationLaunched = false;
      updateCountdown();
    });

    /************ 4) FLOATING HEARTS (BACKGROUND) ************/
    const hearts = document.querySelector(".hearts");
    function spawnHeart(){
      const h = document.createElement("span");
      h.className = "heart";
      h.textContent = "â™¥";
      const size = 12 + Math.random()*24;
      h.style.left = Math.random() * 100 + "vw";
      h.style.fontSize = size + "px";
      const dur = 6 + Math.random()*6;
      h.style.animationDuration = dur + "s";
      h.style.opacity = 0.5 + Math.random()*0.5;
      hearts.appendChild(h);
      h.addEventListener("animationend", () => h.remove());
      const drift = (Math.random() * 40 - 20) + "px";
      h.animate([{ transform: "translateX(0)" }, { transform: `translateX(${drift})` }], { duration: dur*1000, fill: "forwards" });
    }
    setInterval(spawnHeart, 500);
  </script>
</body>
</html>